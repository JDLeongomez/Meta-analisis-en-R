---
title: 'Meta-análisis de correlaciones y meta-regresión en R:'
subtitle: 'Guía práctica'
author:
  - name: Juan David Leongómez \orcidlink{0000-0002-0092-6298}
    correspondence: false
date: "`r Sys.setlocale('LC_TIME');format(Sys.Date(),'%d %B, %Y')`"
output:
  bookdown::pdf_document2:
    number_sections: yes
    keep_tex:  true
    toc: no
    pandoc_args:
      - '--lua-filter=lua/scholarly-metadata.lua'
      - '--lua-filter=lua/author-info-blocks.lua'
      - '--highlight-style=theme/my_style.theme'
classoption: 
      - bookmarksnumbered
editor_options:
  chunk_output_type: console
geometry: margin=2cm
header-includes: 
  \usepackage{setspace}
  \usepackage{float} 
  \floatplacement{figure}{H}
  \usepackage[utf8]{inputenc}
  \usepackage{fancyhdr}
  \pagestyle{fancy}
  \lhead{Juan David Leongómez}
  \rhead{\textit{Meta-análisis de correlaciones en {R:} Guía práctica}}
  \rfoot{\footnotesize{{doi:}
    \href{https://doi.org/10.5281/zenodo.5640182}{10.5281/zenodo.5640182}}}
  \lfoot{\footnotesize{Versión 2}}
  \renewcommand{\abstractname}{Descripción}
  \usepackage[spanish]{babel}
  \usepackage{hanging}
  \usepackage{amsthm,amssymb,amsfonts}
  \usepackage{tikz,lipsum,lmodern}
  \usepackage[most]{tcolorbox}
  \usepackage{fontawesome5}
  \usepackage{svg}
  \usepackage{multirow,booktabs,caption}
  \renewcommand\spanishtablename{Tabla}
  \DeclareCaptionLabelSeparator*{spaced}{\\[1ex]}
  \DeclareCaptionLabelSeparator{point}{. }
  \captionsetup[table]{labelfont=bf,
    textfont=it,
    format=plain,
    justification=justified,
    singlelinecheck=false,
    labelsep=spaced,
    skip=5pt}
  \captionsetup[figure]{labelfont=bf,
    format=plain,
    justification=justified,
    singlelinecheck=false,labelsep=point,skip=5pt}
  \captionsetup[figure]{font=small}
  \usepackage{orcidlink}
  \definecolor{iacol}{RGB}{246, 130, 18}
  \definecolor{iacoldark}{RGB}{246, 100, 18}
always_allow_html: yes
csl: https://raw.githubusercontent.com/citation-style-language/styles/master/apa.csl
urlcolor: blue
linkcolor: iacoldark
link-citations: true
bibliography: bib/references.bib
---

```{=latex}
\newtcolorbox[auto counter]{ROut}[2][]{
                lower separated=false,
                colback=white,
                colframe=iacol,
                fonttitle=\bfseries,
                colbacktitle=iacol,
                coltitle=black,
                boxrule=1pt,
                sharp corners,
                breakable,
                enhanced,
                attach boxed title to top left={yshift=-0.1in,xshift=0.15in},
                boxed title style={boxrule=0pt,colframe=white,},
              title=#2,#1}
```

```{r setup, include = FALSE}
library(knitr)
opts_chunk$set(comment = NA)
def_hook <- knit_hooks$get("output")
knit_hooks$set(output = function(x, options){
  out <- def_hook(x, options)
  return(paste("\\begin{ROut}{Consola de R: Output~\\thetcbcounter}
                \\begin{footnotesize}
                \\begin{verbatim}", 
               x,
               "\\end{verbatim}
                \\end{footnotesize}
                \\end{ROut}"))
})
library(robumeta)
library(metafor)
library(tidyverse)
library(ggpubr)
library(kableExtra)
```

```{=latex}
\begin{center}
\textit{\textbf{EvoCo}: Laboratorio de Evolución y Comportamiento Humano}, Facultad de Psicología, Universidad El Bosque, Bogotá, Colombia. Email: \href{mailto:jleongomez@unbosque.edu.co}{jleongomez@unbosque.edu.co}. Web: \href{https://jdleongomez.info/es}{jdleongomez.info}.

\vfill
\textbf{Descripción}
\end{center}

\par
\begingroup
\leftskip3em
\rightskip\leftskip
```

El meta-análisis es un método muy utilizado para sintetizar datos de distintos estudios. Sin embargo, estudiantes e investigadores carecen con frecuencia de conocimientos prácticos para hacer un meta-análisis. Esta guía presenta una serie de herramientas y para hacer meta-análisis de correlaciones en R: desde análisis simples y su interpretación, hasta hasta análisis con moderadores, con base en ejemplos. Todos los análisis se hacen principalmente usando los paquetes [`metafor`](https://www.metafor-project.org/doku.php) [@viechtbauer2010] y [`metaviz`](https://cran.r-project.org/web/packages/metaviz/vignettes/metaviz.html) [@KossmeierMetaviz]. Incluye además explicaciones para la transformación de coeficientes *r* de Pearson a *z* de Fisher (y viceversa), así como creación de *forest plots* y *funnel plots*, análisis de heterogeneidad y diagnósticos de influencia, y estrategias para detectar posibles sesgos de publicación usando el paquete [`weightr`](https://www.r-pkg.org/pkg/weightr) [@coburnWeightr2019], así como para determinar el poder estadístico de un meta-análisis usando [`metameta`](https://www.dsquintana.blog/metameta-r-package-meta-analysis/) [@quintanaMetameta2022]. 

El meta-análisis es un método ampliamente utilizado para sintetizar los datos de diferentes estudios. Sin embargo, a menudo los estudiantes e investigadores carecen de conocimientos prácticos para llevar a cabo un meta-análisis. Esta guía presenta una serie de herramientas y ejemplos para realizar meta-análisis de correlaciones en R, desde análisis simples y su interpretación hasta análisis con moderadores (meta-regresión). Los análisis se realizan principalmente utilizando los paquetes [`metafor`](https://www.metafor-project.org/doku.php) [@viechtbauer2010] y [`metaviz`](https://cran.r-project.org/web/packages/metaviz/vignettes/metaviz.html) [@KossmeierMetaviz]. También se incluyen explicaciones para la transformación de coeficientes *r* de Pearson a *z* de Fisher (y viceversa), creación de gráficos de bosque (*forest plots*) y gráficos de embudo (*funnel plots*), análisis de heterogeneidad y diagnósticos de influencia, así como estrategias para detectar posibles sesgos de publicación utilizando el paquete [`weightr`](https://www.r-pkg.org/pkg/weightr) [@coburnWeightr2019], así como para determinar el poder estadístico de un meta-análisis utilizando [`metameta`](https://www.dsquintana.blog/metameta-r-package-meta-analysis/) [@quintanaMetameta2022].

```{=latex}
\begin{small}

\textbf{Nota}: Está guía está parcialmente basada en \href{https://youtu.be/lH4VZMTEZSc}{este video} de \cite{quintanaHowPerformMetaanalysis2021}, pero contiene pasos adicionales o alternativos, así como citas a fuentes primarias, e información complementaria y más detallada. Como tal, asume un manejo básico de R, así como una comprensión de correlaciones y regresiones, y un entendimiento general de los principios del meta-análisis. Sin embargo, de ser necesario y como preámbulo, recomiendo ver \href{https://youtu.be/ntBbkOn9D_o}{este video introductorio al meta-análisis en \textit{jamovi}} \cite{leongomezMetaanalysis2021} que publiqué anteriormente en mi canal de YouTube \href{https://www.youtube.com/@InvestigacionAbierta}{\textit{Investigación Abierta}}.

\end{small}
```

[![Investigación Abierta](images%5CLogo-IA-Rectangulo.pdf)](https://www.youtube.com/@InvestigacionAbierta)

```{=latex}
\par
\endgroup
\vfill

\textbf{Cita esta guía como } \hrulefill 

\begin{hangparas}{.25in}{1}
Leongómez, J. D. (2022). Meta-análisis de correlaciones y meta-regresión en R: Guía práctica. \textit{Zenodo}. \url{https://doi.org/10.5281/zenodo.5640182}
\end{hangparas}
\newpage

{\hypersetup{hidelinks}
 \setcounter{tocdepth}{5}
 \tableofcontents
}
\newpage
```

# Base de datos de ejemplo

Para los ejemplos usados en ésta guía, usaré la base de datos `dat.molloy2014`, tomada de @molloy2013. Esta base de datos viene incluida con el paquete `metafor` de R. 

Básicamente, @molloy2013 estudiaron si existe una asociación entre la concienciación (*conscientiousness*[^1]) y la adherencia a la medicación. En otras palabras, ¿las personas más *concienciadas* tienden a cumplir más con la medicación prescrita?

[^1]: Para una definición detallada del concepto de concienciación, ver @johnBigFiveTrait1999.

Primero, debemos cargar los principales paquetes que usaré a lo largo de esta guía: `metafor` [@viechtbauer2010] y `metaviz` [@KossmeierMetaviz] para hacer e ilustrar los resultados del meta-análisis, así como `dplyr` [@WickhamDplyr2021] y `forecats` [@Wickhamforcats2022] para manipular y organizar la base de datos.

```{r eval = FALSE}
library(metafor)
library(metaviz)
library(dplyr)
library(forcats)
```

Como ya hemos cargado el paquete `metafor`, ya podemos cargar la base de datos `dat.molloy2014`. En éste caso, para poder *llamarla* cuando sea necesario, la asignaré a un objeto que sencillamente llamaré `dat`.

```{r}
dat <- get(data(dat.molloy2014))
```

\newpage

# Referencias

<div id="refs"></div>

# APÉNDICES {.unnumbered}

# (APPENDIX) Appendix {-}  

# Alternativas a `metafor`

Acá he usado principalmente una ruta para hacer meta-análisis basada en el paquete `metafor`, acompañado de `metaviz` para visualizaciones, `weightr` para ajustar pesos y detectar sesgos de publicación, y `metameta` para estimar el poder estadístico de un meta-análisis.

Sin embargo, existen rutas alternativas para realizar meta-análisis en R. El libro *Doing meta-analysis with R: a hands-on guide* [@harrer2021doing] se acompaña del paquete [`dmetar`](https://dmetar.protectlab.org/index.html) [@Harrer2019dmetar], que contiene opciones para hacer meta-análisis tanto a partir de `metafor`, como a partir de `meta` [@BalduzziMeta2019; @schwarzerMetaAnalysis2015].

De manera importante, los objetos generados por `meta` al realizar un meta-análisis permiten hacer otros análisis como *risk of bias* (riesgo de sesgo), inferencia multi-modelo, detección de *outliers* (valores atípicos), y *p-curve* o curva de valores $p$ [@simonsohnPCurveEffectSize2014], así como opciones para hacer gráficos distintos. Para una guía resumida y concreta (en inglés) de estas opciones, recomiendo ver el sitio web del paquete [`dmetar`](http://dmetar.protectlab.org/), y en especial la página [*Get Started*](https://dmetar.protectlab.org/articles/dmetar.html).

# Citas y referencias de paquetes de R

Por supuesto, los paquetes de R que usemos deben ser citados. Una manera fácil de encontrar la cita que los autores de un paquete quieren que usemos, es la función `citation` en R. Simplemente debemos usar esta función, agregando como argumento el nombre del paquete que queremos citar entre comillas. Esto nos dará la referencia en un formato estándar, así como como en un formato `BibTex` que puede ser usado en documentos \LaTeX, o por muchos gestores de referencia (alternativamente nos permite saber los campos como autores, título y demás, si vamos a crear las citas y referencias manualmente).

Por ejemplo, en ésta guía usé `dplyr` [@WickhamDplyr2021] para manipular los datos, y usando la función `citation`, obtengo esta información:

```{r}
citation("dplyr")
```

# Paquetes de R y versiones usados para crear este documento (para garantizar reproducibilidad)

```{r echo = FALSE}
library(pander)
pander(sessionInfo(), locale = FALSE)
```
