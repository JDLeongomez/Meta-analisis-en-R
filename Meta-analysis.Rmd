---
title: 'Meta-análisis en R'
subtitle: 'Guía básica'
author:
  - name: Juan David Leongómez
    email: jleongomez@unbosque.edu.co
    institute: ueb
    correspondence: false
institute:
  - ueb: 'Laboratorio de Análisis del Comportamiento Humano (LACH), Facultad de Psicología, Universidad El Bosque, Bogotá, Colombia. Email: jleongomez@unbosque.edu.co. Web: [jdleongomez.info](https://jdleongomez.info/es/).'
date: "`r Sys.setlocale('LC_TIME');format(Sys.Date(),'%d %B, %Y')`"
output:
  bookdown::pdf_document2:
    highlight: zenburn
    number_sections: yes
    toc: no
    pandoc_args:
      - '--lua-filter=scholarly-metadata.lua'
      - '--lua-filter=author-info-blocks.lua'
editor_options:
  chunk_output_type: console
geometry: margin=2cm
header-includes: 
  \usepackage{float} 
  \floatplacement{figure}{H} 
  \usepackage[utf8]{inputenc} 
  \usepackage{fancyhdr}
  \pagestyle{fancy} 
  \lhead{Guía básica} 
  \rhead{\textit{Meta-análisis en R}} 
  \renewcommand{\abstractname}{Descripción}
  \usepackage[spanish]{babel}
  \renewcommand\spanishtablename{Tabla}
  \usepackage{multirow,booktabs,setspace,caption}
  \usepackage{tikz}
  \DeclareCaptionLabelSeparator*{spaced}{\\[2ex]}
  \captionsetup[table]{textfont=it,format=plain,justification=justified,
  singlelinecheck=false,labelsep=spaced,skip=0pt}
  \captionsetup[figure]{labelsep=period,labelfont=it,justification=justified,
  singlelinecheck=false,font=doublespacing}
always_allow_html: yes
csl: https://raw.githubusercontent.com/citation-style-language/styles/master/apa.csl
urlcolor: blue
linkcolor: red
link-citations: true
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(robumeta)
library(metafor)
library(dplyr)
library(ggpubr)
```

```{=tex}
\begin{center}
\textbf{Descripción}
\end{center}
```
Este documento contiene todo el código explicaciones básicas, paso a paso, para hacer un meta-análisis en R, usando los paquetes [`metafor`](https://www.metafor-project.org/doku.php) [@viechtbauer2010] y [`robumeta`](https://www.rdocumentation.org/packages/robumeta) [@fisherRobumetaRpackageRobust2015]. Está principalmente basado en [este video](https://youtu.be/lH4VZMTEZSc), creado por Daniel S. Quintana [-@quintanaHowPerformMetaanalysis2021], pero contiene citas a fuentes primarias, además de información que he agregado.

```{=latex}
{\hypersetup{hidelinks}
\setcounter{tocdepth}{5}
\tableofcontents
}
```
# Meta-análisis de correlación

## Base de datos de ejemplo

La base de datos `dat.molloy2014`, tomada de Molloy et al. [-@molloy2013] viene incluída con `{metafor}`. Básicamente, estudia si existe una asociación entre la diligencia (*conscientiousness*) y la adherencia a la medicación. En otras palabras, ¿las personas más diligentes son más propensas a cumplir con la medicación prescrita?

```{r molloy2014}
dat <- get(data(dat.molloy2014))
dat <- mutate(dat, study_id = 1:16) #agregar columna study_id
dat <- dat %>% select(study_id, 
                      authors:quality) #mover study_id como primera columna
```

La base da datos, que he asignado a un objeto llamado `dat`, tiene ahora la siguiente estructura (Tabla \@ref(tab:estructura)):

```{r estructura, echo=FALSE, message = FALSE}
library(kableExtra)

kable(dat, 
      linesep = "",
      booktabs = TRUE,
      caption = "Estructura de la base de datos") %>% 
  kable_styling(latex_options = c("HOLD_position", "scale_down")) %>% 
  footnote(general = "Datos tomados de Molloy et al. (2013).",
           general_title = "Nota:",
           footnote_as_chunk = TRUE)
```

La columna `ri` contiene los coeficientes de correlación de Pearson (la columna `ni` contiene los tamaños de muestra de cada estudio). Dado que los coeficientes de Pearson no tienen una distribución normal, esto podría llevar a calcular varianzas incorrectas, especialmente cuando se trata de correlaciones con tamaños de muestra pequeños.

Adicionalmente, en este ejemplo tenemos una serie de moderadores:

-   `controls`: número de variables controladas

-   `design`: si se utilizó un diseño transversal o prospectivo

-   `a_measure`: tipo de medida de adherencia (autoinforme u otro)

-   `c_measure`: tipo de medida de diligencia (NEO u otra)

-   `meanage`: edad promedio de la muestra

-   `quality`: calidad metodológica

## Transformación de *r* de Pearson a *z* de Fisher

Por esto, vamos a transformar los coeficientes *r* de Pearson a *z* de Fisher, que no tienen este problema. Para esto, vamos a usar la función `escalc` del paquete `metafor`.

```{r}
dat <- escalc(measure = "ZCOR", 
              ri = ri, 
              ni = ni,
              data= dat, 
              slab = paste(authors, year, sep = ", "))
```

Esto ha creado dos nuevas variables en nuestra tabla: `yi`, que es el tamaño de efecto, y `vi` que es la varianza.

```{r echo=FALSE, message = FALSE}
kable(dat, 
      linesep = "",
      booktabs = TRUE,
      caption = "Estructura de la base de datos, con transformación de los r de Pearon a z de Fisher") %>% 
  kable_styling(latex_options = c("HOLD_position", "scale_down")) %>% 
  footnote(general = "Datos tomados de Molloy et al., (2013).",
           general_title = "Nota:",
           footnote_as_chunk = TRUE) %>% 
  column_spec(12:13, background = "#c4c4c4")
```

## Hacer el meta-análisis {#meta-cor}

Para hacer el meta-análisis, usaremos la función `rma` del paquete `metafor`, para el que tenemos que especificar los tamaños de efecto (`yi`) y varianzas (`vi`) de los estudios a meta-analizar. En este caso, las columnas donde tenemos estos valores, tienen los mismos nombres (`yi`, `vi`). Asignaré los resultados del meta-análisis a un objeto llamado `res`.

```{r}
res <- rma(yi = yi, vi = vi, data = dat)
```

Los resultados, son los siguientes:

```{r}
res
```

Primero, nos confirma que ajustamos un modelo con efectos aleatorios (`Random-Effects Model`), a partir de 16 estudios (`k = 16`), y que para estimar $\tau^2$ (tau cuadrado[^1]) usamos el método de **máxima verosimilitud restringida**[^2] (`tau^2 estimator: REML`), que se designa como *REML* por sus siglas en inglés.

[^1]: $\tau^2$ es una estimación de la varianza de los tamaños de los efectos reales entre los estudios meta-analizados. Se usa, principalmente, para asignar pesos a cada estudio. Para más información, ver [@borensteinIdentifyingQuantifyingHeterogeneity2009].

[^2]: Hay varios métodos disponibles como estimador, además de **máxima verosimilitud restringida** (REML). Sin embargo, si no estás seguro, REML es una buena opción. Cada método tiene ventajas y desventajas que, si tienes interés en mirar, están descritas en la [documentación](https://www.rdocumentation.org/packages/metafor/versions/2.4-0/topics/rma.uni) de la función `rma`.

Posteriormente, nos provee los valores de una serie de estimadores de heterogeneidad o varianza:

-   $\tau^2$: `tau^2 (estimated amount of total heterogeneity): 0.0081 (SE = 0.0055)`

-   $\tau$: `tau (square root of estimated tau^2 value): 0.0901`

-   $I^2$: `I^2 (total heterogeneity / total variability): 61.73%`, y

-   $H^2$: `H^2 (total variability / sampling variability):  2.61`

La tercera parte, reporta una prueba de heterogeneidad, usando el estadístico $Q$:

-   `Test for Heterogeneity:`

    `Q(df = 15) = 38.1595, p-val = 0.0009`

De todos estos, los más comúnmente reportados son $\tau^2$, $\tau$, $I^2$ y $Q$. Cada una de estas medidas tiene ventajas y desventajas, por lo cual tiene sentido reportarlas todas.

$I^2$, por ejemplo, tiene la ventaja de ser sencillo de interpretar, pues hay criterios generales para heterogeneidad baja, moderada y alta (típicamente 25%, 50%, and 75%, respectivamente). Sin embargo, es muy sensible a los tamaños de muestra de los estudios meta-analizados (por ejemplo, si en tu meta-análisis hay estudios con tamaños de muestra muy grandes, esto va a sesgar tu $I^2$).

$Q$, aunque no es sensible al tamaño de muestra, es sensible al número de estudios meta-analizados. Tiene la ventaja de ser un test de hipótesis, y como tal, puede ser interpretado a partir de su valor *p*.

$\tau^2$ no tiene estos problemas, pero es más difícil de interpretar.

En nuestro caso, el estadístico $Q$ sugiere que hay una heterogeneidad significativa en los estudios meta-analizados ($p$ = 0.0009). $I^2$, sugiere una heterogeneidad moderada, lo que quiere decir que más de la mitad (61.73%) de la varianza se estima que se deriva de diferencias en los tamaños de efecto.

Por último, tenemos los resultados del modelo de meta-análisis (`Model results`). Nos provee un estimado de la asociación positiva entre diligencia y adherencia a la medicación (0.1499 ± 0.0316), lo que equivale a un valor *z* de 4.7501 , y sugiere que esa asociación es significativa ($p$ \< .0001). Así mismo, nos provee los límites inferior (0.0881) y superior (0.2118) de los intervalos de confianza.

### Más información sobre heterogeneidad

Además de reportar los estadísticos $\tau^2$, $\tau$, $I^2$ y $Q$, podemos fácilmente calcular los intervalos de confianza para $\tau^2$, $\tau$, e $I^2$ con la función `confint`, que también pueden ser reportado junto a estos estadísticos.

```{r}
confint(res)
```

Para el $\tau^2$, el hecho de que los intervalos de confianza no crucen el 0 (en nuestro caso 0.0017 *---* 0.0378), sugiere que de hecho también que hay heterogeneidad entre los estudios que meta-analizamos.

### Diagnóstico de influencia

Otro aspecto importante de un meta-análisis, es determinar si alguno(s) de los estudios meta-analizados es(son) particularmente influyente(s) en nuestro resultado[^3]. Para esto, podemos usar la función `influence`, cuyo resultado en este caso asignaré a un objeto llamado `inf`.

[^3]: Por ejemplo, si estuviésemos meta-analizando 20 estudios, de los cuales 19 tienen un *n* de 100, pero el otro tiene un *n* de 10.000, éste último tendrá una influencia enorme en nuestro resultado. Sería preocupante que tu meta-análisis sea dependiente de un único estudio.

```{r}
inf <- influence(res)
```

Ya que lo asigné a un objeto (`inf`), para ver el resultado, tengo que correrlo para ver su resultado.

```{r}
inf
```

Esto me muestra gran cantidad de información de cada estudio (en este caso, una tabla sin formato, que es muy ancha para poder imprimirse en esta página, por lo cual está reportada en dos partes). Sin embargo, lo más importante ahora es mirar la última columna, también llamada `inf`. Si ahí aparecieran asteriscos (que no es nuestro caso), sugeriría que ese estudio es particularmente influyente.

Por último, podemos también ver ésta información que tenemos guardada en el objeto `inf`, de manera gráfica, usando la función `plot`.

```{r fig.cap = "Diagnóstico de influencia. Estudios particularmente influyentes serpian representados con un punto rojo. En este caso, no hay ningún estudio que se considere demasiado influyente, por lo que podemos estar tranquilos con nuestro meta-análisis."}
plot(inf)
```

### *Forest plot* (diagrama de bosque)

Para hacer un diagrama de bosque (*forest plot*) con [`metafor`](https://www.metafor-project.org/doku.php) resumiendo nuestro meta-análisis, solo tenemos que usar la función `forest`, usando como argumento el objeto al que asignamos los resultados de nuestro meta-análisis (`res`).

Como se puede ver en las Figuras \@ref(fig:for-plot1), \@ref(fig:for-plot2) y \@ref(fig:for-plot3) (que son 3 versiones del mismo f*orest plot*), no es una sorpresa que el análisis nos sugiera bastante heterogeneidad; las correlaciones encontradas entre los diferentes estudios varían mucho (están entre `r min(dat$ri)` y `r max(dat$ri)`), y aunque son positivas en la mayoría de los casos (en algunos claramente positivas), en algunos son prácticamente 0 o incluso negativas.

```{r for-plot1, fig.height=6, fig.cap = "*Forest plot* básico de [metafor](https://www.metafor-project.org/doku.php). Para cada estudio meta-analizado, tenemos el efecto (correlación, en este caso en valores *z* de Fisher), así como sus intervalos de confianza entre paréntesis cuadrados. Esta misma información está representada gráficamente, con los cuadrados representando el efecto de cada estudio así como sus intervalos de confianza, y el tamaño de muestra (representado por el tamaño del cuadrado). Bajo estos resultados, tenemos nuestro meta-análisis, con el mismo formato en texto, pero representando el efecto y sus intervalos de confianza con un diamante."}
forest(res)
```

Para una versión más completa y anotada, también usando el *plot* básico de [`metafor`](https://www.metafor-project.org/doku.php), pero representando coeficientes de correlación de Pearson (*r*) en vez de valores *z*, así como agregando una columna con los pesos dados a cada estudio, y detalles del modelo final, podemos agregar algunas opciones (explicadas [acá](https://search.r-project.org/CRAN/refmans/metafor/html/forest.rma.html)):

```{r for-plot2, fig.height=5, fig.cap = "*Forest plot* anotado, creado con [metafor](https://www.metafor-project.org/doku.php). En esta versión agregué algunos encabezados en español, así como estadísticos generales del modelo de meta-análisis. Modelo EA se refiere al modelo meta-analizado, de efectos aleatorios."}
# forest plot con anotaciones adicionales
forest(res, cex = 0.75, xlim = c(-1.6, 1.6), 
       showweights = TRUE,
       atransf = transf.ztor, 
       xlab = "Correlación (r)",
       digits = c(2,3L),
       at = transf.rtoz(c(-0.4, -0.2, 0, 0.2, 0.4, 0.6)),
       mlab = bquote(paste("Modelo EA: Q(", .(res$k - res$p), ") = ",
     .(formatC(res$QE, digits=2, format="f")),
     ", p ", .(scales::pvalue(res$pval)), "; ", I^2, " = ",
     .(formatC(res$I2, digits=1, format="f")), "%")))
# agregar encabezados a las columnas (valores de X y Y deben ser ajustados)
op <- par(cex = 0.8, font=2) 
text(x = -1.6, y = 18, labels = "Autor(es), Año", pos = 4)
text(x = 0, y = 18, labels = "Efecto e IC", pos = 4)
text(x = 1, y = 18, labels = "Peso", pos = 2)
text(x = 1.6, y = 18, labels = "Corr. [95% IC]", pos = 2)
```

O, para una incluso más sofisticada, se puede usar la función [`viz_forest`](https://cran.r-project.org/web/packages/metaviz/vignettes/metaviz.html#creating-forest-plots-with-function-viz_forest) del paquete [`metaviz`](https://cran.r-project.org/web/packages/metaviz/vignettes/metaviz.html), en este caso usando la variante `rain` (no es necesaria).

```{r for-plot3, fig.height=4, warning = FALSE, fig.cap = "*Forest plot* creado con [metaviz](https://cran.r-project.org/web/packages/metaviz/vignettes/metaviz.html)."}
library(metaviz)
viz_forest(res, 
           study_labels = paste(dat$authors, dat$year, sep = ", "),
           xlab = "Correlación", 
           variant = "rain",
           annotate_CI = TRUE,
           summary_label = "Resumen",
           text_size = 2.6)
```

### *Funnel plot* (diagrama de embudo) y sesgo de estudios pequeños

En este punto, es en donde más errores se cometen. Las pruebas más comunes para evaluar sesgos de publicación, son la evaluación de la asimatría en el *funnel plot* (diagrama de embudo), y la regresión (o test) de Egger [@eggerBiasMetaanalysisDetected1997].

El principal error que la mayoría de los investigadores (meta-analistas) cometen, es que simplemente basándose en éstos métodos, concluyen que un meta-análisis tiene (o no) riesgo de sufrir de un sesgo de publicación. Sin embargo, estos métodos, no son pruebas exclusivas de sesgo de publicación, sino de sesgo de estudios de tamaño muestral pequeño [ver e.g. @schwarzerSmallStudyEffectsMetaAnalysis2015], que pueden incluir sesgo de publicación, pero no se centran exclusivamente en éste.

A pesar de esto, tanto la regresión de Egger como el *funnel plot*, son intersantes dado que el sesgo de estudios pequeños es importante.

#### *Funnel plot*

Para crear un *funnel plot* con [`metafor`](https://www.metafor-project.org/doku.php), de nuestro meta-análisis, solo tenemos que usar la función `funnel`, usando como argumento el objeto al que asignamos los resultados de nuestro meta-análisis (`res`).

```{r funnel-plot1, fig.height=6, fig.cap = "*Funnel plot* básico de [metafor](https://www.metafor-project.org/doku.php). Para cada estudio meta-analizado, tenemos el efecto (correlación, en este caso en valores *z* de Fisher) en el eje *X*, así como su error estándar en el eje *Y*. La línea punteada vertical representa el efecto meta-analizado que hemos encontrado, así que podemos ver los estudios que encontraron un efecto mayor (derecha de la línea punteada) o menor (izquierda) de éste. A primera vista no parece haber mucha asimetría, pero es importante tener en cuenta que es un análisis muy subjetivo."}
funnel(res)
```

De nuevo, se puede usar el paquete [`metaviz`](https://cran.r-project.org/web/packages/metaviz/vignettes/metaviz.html), usando la función [`viz_funnel`](https://cran.r-project.org/web/packages/metaviz/vignettes/metaviz.html#creating-funnel-plots-with-viz_funnel). Hay muchas opciones, pero como ejemplo, usaré la versión por defecto, agregando solo la línea de la regressión de Egger (`egger = TRUE`; ver sección \@ref(reg-egger), a continuación), y transformando los tamaños de efecto de regreso a $r$ de Pearson (`x_trans_function = tanh`).

```{r funnel-plot2, fig.height=4, warning = FALSE, fig.cap = "*Funnel plot* creado con [metaviz](https://cran.r-project.org/web/packages/metaviz/vignettes/metaviz.html). En azul, se representa el área donde estudios, segpun su error (y su tamaño de muestra), tendrían un efecto significativo al 5% (i.e. $p$ > 0.05), y fuera de ésta, donde tendrían un efecto significativo al 1% (i.e. $p$ > 0.01). La línea negra vertical representa el efecto meta-analizado, y el triángulo a partir de su inicio, el área donde se ubican los estudios que no se diferencian significativamente del resultado del meta-análisis. La línea roja punteada, representa la regresión de Egger."}
viz_funnel(res, 
           egger = TRUE,
           x_trans_function = tanh)
```

Alternativamente, el paquete [`metaviz`](https://cran.r-project.org/web/packages/metaviz/vignettes/metaviz.html) tiene la función [`viz_sunset`](https://cran.r-project.org/web/packages/metaviz/vignettes/metaviz.html#sunset-power-enhanced-funnel-plots), que permite además mostrar el poder estadístico (o potencia) de los estudios meta-analizados para detectar un efecto de interés mediante una prueba de Wald de dos colas. A continuación, muestro dos versiones de esta función. En ambos casos, agregué el efecto *real* encontrado con el meta-análisis (`contours = TRUE`), y transformé los tamaños de efecto de regreso a $r$ de Pearson (`x_trans_function = tanh`).

```{r eval = FALSE}
# Escala de poder discreta
viz_sunset(res,
           contours = TRUE,
           x_trans_function = tanh)

# Escala de poder contínua
viz_sunset(res, 
           contours = TRUE,
           x_trans_function = tanh, 
           power_contours = "continuous")
```

```{r funnel-plot3, message = TRUE, echo = FALSE, fig.height=8, fig.width=6, warning = FALSE, fig.cap = "Dos versiones de *funnel plot* creados con [metaviz](https://cran.r-project.org/web/packages/metaviz/vignettes/metaviz.html), usando la función viz-sunset, que estima el poder de cada estudio para detectar un efecto de interés. **A.** Poder representado por bandas dicretas de color. **B.** Poder representado de manera contpinua en una escala de color. En ambos casos, y tal como en la Fig. \\@ref(fig:funnel-plot2), el efecto real está representado como una línea vertical, y el triángulo a partir de su inicio representa el área donde se ubican los estudios que no se diferencian significativamente del resultado del meta-análisis."}
p.suna <- viz_sunset(res, 
                     contours = TRUE,
                     x_trans_function = tanh)
p.sunb <- viz_sunset(res, 
                     contours = TRUE,
                     x_trans_function = tanh,
                     power_contours = "continuous")
ggarrange(p.suna, p.sunb,
          labels = "AUTO",
          nrow = 2)
```

#### Regresión de Egger {#reg-egger}

Para hacer una prueba formal de sesgo de estudios pequeños, podemos hacer una prueba o regresión de Egger [@eggerBiasMetaanalysisDetected1997]. En [`metafor`](https://www.metafor-project.org/doku.php), esto se hace con la función `regtest`, de nuevo usando como argumento el objeto al que asignamos el resultado de nuestro meta-análisis (`res`).

```{r echo = FALSE}
regegger <- regtest(res)
```

```{r eval = FALSE}
regtest(res)
```

Como se puede ver, la prueba de Egger no muestra un resultado significativo (`z = 1.0216, p = 0.3070`).

Con base en esto, y la inspección visual subjetiva del *funnel plot*, muchos investigadores concluyen que no hay sesgo de publicación. Sin embargo, como mencioné antes, estas pruebas no se centran en el sesgo de publicación sino en el sesgo de estudios pequeños. En otras palabras, con base en esto, lo único que podemos concluir correctamente, es que no hay sesgo de estudios pequeños (más adelante, en la sección XXXXX, explicaré cómo evaluar si hay sesgo de publicación).

## Meta-análisis de correlación con moderador

### Ejemplo 1: Moderación de la edad promedio de los participantes

Primero, y como ejemplo, vamos a ver si la edad (en nuestros datos, `meanage`) modera el resultado. Esto es importante, pues hay una enorme variación entre las edades medias de los participantes de los diferentes estudios[^4], lo que podría moderar (afectar) la asociación entre diligencia (*conscientiousness*) y adherencia a la medicación prescrita.

[^4]: De hecho, mientras que en el estudio de `r paste0(dat$authors[which.min(dat$meanage)], " (", dat$year[which.min(dat$meanage)], ")")` la edad promedio fue de `r min(dat$meanage)`, en el estudio de `r paste0(dat$authors[which.max(dat$meanage)], " (", dat$year[which.max(dat$meanage)], ")")` la edad promedio fue de `r max(dat$meanage)`.

Para esto, de nuevo podemos usar la función `rma` de paquete `metafor` y de la misma manera que en la sección \@ref(meta-cor), pero agregando nuestra variable moderadora (`meanage`) al argumento `mods`. En este caso voy a asignar a un objeto llamado `res.modage`, para diferenciarlo del objeto `res` al que asigné el meta-análisis básico, sin moderadores.

```{r}
res.modage <- rma(yi = yi, vi = vi, mods = ~meanage, data = dat)
```

Los resultados, son los siguientes:

```{r}
res.modage
```

Los resultados, que tienen la misma organización que los del análisis sin moderadores (sección \@ref(meta-cor)) resultado nos muestra que, a pesar de la gran diferencia de edad entre estudios, la edad no tiene un efecto significativo, como se puede ver en la columna `pval` para el efecto de `meanage` (`r round(res.modage$pval[2], 4)`).

#### *Forest plot* y *funnel plot* {#plot-mod}

Por supuesto, de estos resultados también puedo crear *forest plots* y *funnel plots*, siguiendo los ejemplos y código de la sección \@ref(meta-cor).

Para el *forest plot*, hago a continuación un ejemplo usando la opción básica (por supuesto, se pueden crear versiones anotadas y mejoradas, pero la función [`viz_forest`](https://cran.r-project.org/web/packages/metaviz/vignettes/metaviz.html#creating-forest-plots-with-function-viz_forest) del paquete [`metaviz`](https://cran.r-project.org/web/packages/metaviz/vignettes/metaviz.html) tendrá problemas para crear un *forest plot* de un meta-análisis con moderadores).

```{r for-plot-mod1, warning = FALSE, fig.height=6, fig.cap = "*Forest plot* básico de [metafor](https://www.metafor-project.org/doku.php), para un meta-análisis incluyendo la edad promedio de los participantes como moderador. En la ilustración gráfica, además de los efectos originales, se puede ver el efecto de cada estudio estimado cuando se incluye el moderador como polígonos (diamantes) de color gris. Sin embargo, ya no obtenemos una fila representando el efecto promediado del meta-análisis, ya que no tenemos un solo efecto."}
# forest plot con anotaciones adicionales
forest(res.modage, xlim = c(-1.6, 1.6))
text(-1.6, 18, "Autor(es), Año", pos = 4)
text(1.6, 18, "Correlación [95% CI]", pos = 2)
```

De manera similar, podemos obtener un *funnel plot* de nuestro meta-análisis con moderador, pero éste nos mostrará, en vez de los coeficientes de correlación (transformados a $z$ de Fisher), los valores residuales de cada estudio (es decir, qué tanto se alejan del resultado de nuestro meta-análisis):

```{r funnel-plot-mod1, fig.height=6, fig.cap = "*Funnel plot* básico de [metafor](https://www.metafor-project.org/doku.php), para un meta-análisis incluyendo la edad promedio de los participantes como moderador. La línea punteada vertical representa el efecto meta-analizado que hemos encontrado, así que podemos ver los estudios que encontraron un efecto mayor (derecha de la línea punteada) o menor (izquierda) de éste."}
funnel(res.modage)
```

### Ejemplo 2: Moderación de la calidad de los estudios meta-analizados

La base de datos con tiene una medida de calidad metodológica de los estudios (variable `quality`). Dicha calidad, también podría moderar la asociación entre diligencia (*conscientiousness*) y adherencia a la medicación prescrita. Siguiendo los mismos pasos, puedo hacer éste análisis, pero voy a asignar este meta-análisis a un objeto llamado `res.modq` para diferenciarlo de los demás.

```{r}
res.modq <- rma(yi = yi, vi = vi, mods = ~quality, data = dat)
res.modq
```

De nuevo, encontramos que éste moderador (`quality`), al igual que la edad promedio (`meanage`), no tiene un efecto significativo, como se puede ver en la columna `pval` para el efecto de `quality` (`r round(res.modq$pval[2], 4)`).

Por supuesto, *forest plots* y *funnel plots* pueden ser creados, tal y como describí en la sección \@ref(plot-mod).

### Ejemplo 3: Moderación de las controles usados en cada estudio meta-analizado

Como último ejemplo, voy a mirar si el hecho de que los estudios tengan variables que fueron controladas, modera la asociación entre diligencia (*conscientiousness*) y adherencia a la medicación prescrita. Siguiendo los mismos pasos, voy hacer éste análisis, pero voy a asignar este meta-análisis a un objeto llamado `res.mes`. Son embargo, dado que la variable que contiene esta información (`controls`) es un factor, pero no está definido como tal, debo hacerlo en la usando la función `factor` al ingresar el argumento `mods` (i.e. `mods = ~factor(controls)`).

```{r}
res.mes <- rma(yi = yi, vi = vi, mods = ~factor(controls), data = dat)
res.mes
```

En éste caso, a diferencia de los ejemplos de moderación anteriores, la variable moderadora (`controls`) sí tiene un efecto significativo, como se puede ver en la columna `pval` para el efecto de `factor(controls)none` (`r scales::pvalue(res.mes$pval[2])`), y en los asteriscos que aparecen al final de esa fila (`***`).

Por supuesto, *forest plots* y *funnel plots* pueden ser creados, tal y como describí en la sección \@ref(plot-mod).

## Sesgo de publicación (*publication bias*) {#sesgo-pub}

```{r}
library(weightr)

wf <- weightfunct(effect = dat$yi, v = dat$vi, table = TRUE)
wf
```

# Referencias
